<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bakong KHQR Generator</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- qrcode.js CDN (or similar client-side QR code library) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode.js/qrcode.min.js"></script>
    <style>
        /* Optional: Custom styles if needed */
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Generate Bakong KHQR</h2>

        <div class="space-y-4">
            <div>
                <label for="merchantId" class="block text-sm font-medium text-gray-700">Merchant ID (e.g., jonh_smith@devb)</label>
                <input type="text" id="merchantId" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="jonh_smith@devb">
            </div>
            <div>
                <label for="merchantName" class="block text-sm font-medium text-gray-700">Merchant Name</label>
                <input type="text" id="merchantName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="Jonh Smith">
            </div>
            <div>
                <label for="merchantCity" class="block text-sm font-medium text-gray-700">Merchant City</label>
                <input type="text" id="merchantCity" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="PHNOM PENH">
            </div>
            <div>
                <label for="currency" class="block text-sm font-medium text-gray-700">Currency</label>
                <select id="currency" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="usd">USD</option>
                    <option value="khr">KHR</option>
                </select>
            </div>
            <div>
                <label for="amount" class="block text-sm font-medium text-gray-700">Amount</label>
                <input type="number" id="amount" step="0.01" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="100.50">
            </div>
            <div>
                <label for="mobileNumber" class="block text-sm font-medium text-gray-700">Mobile Number (e.g., 85512233455)</label>
                <input type="text" id="mobileNumber" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="85512233455">
            </div>
            <div>
                <label for="storeLabel" class="block text-sm font-medium text-gray-700">Store Label</label>
                <input type="text" id="storeLabel" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="Coffee Shop">
            </div>
            <div>
                <label for="terminalLabel" class="block text-sm font-medium text-gray-700">Terminal Label</label>
                <input type="text" id="terminalLabel" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="Cashier_1">
            </div>
            <div>
                <label for="purpose" class="block text-sm font-medium text-gray-700">Purpose of Transaction</label>
                <input type="text" id="purpose" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="oversea">
            </div>
            <div>
                <label for="languagePreference" class="block text-sm font-medium text-gray-700">Language Preference</label>
                <select id="languagePreference" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="en">EN</option>
                    <option value="km">KM</option>
                </select>
            </div>
            <div>
                <label for="merchantNameAlt" class="block text-sm font-medium text-gray-700">Merchant Name (Alt Language)</label>
                <input type="text" id="merchantNameAlt" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="ចន ស្មីន">
            </div>
            <div>
                <label for="merchantCityAlt" class="block text-sm font-medium text-gray-700">Merchant City (Alt Language)</label>
                <input type="text" id="merchantCityAlt" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="សៀមរាប">
            </div>
            <div>
                <label for="upiAccount" class="block text-sm font-medium text-gray-700">UPI Merchant Account</label>
                <input type="text" id="upiAccount" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="0001034400010344ABCDEFGHJIKLMNO">
            </div>
        </div>

        <button id="generateQrBtn" class="mt-6 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Generate KHQR Code
        </button>

        <div id="qrCodeContainer" class="mt-8 flex justify-center">
            <!-- QR code will be displayed here -->
        </div>

        <div id="qrDataDisplay" class="mt-4 text-center text-sm text-gray-600 break-all">
            <!-- Raw QR data will be displayed here -->
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('#generateQrBtn').on('click', function() {
                const merchantId = $('#merchantId').val();
                const merchantName = $('#merchantName').val();
                const merchantCity = $('#merchantCity').val();
                const currency = $('#currency').val();
                const amount = parseFloat($('#amount').val());
                const mobileNumber = $('#mobileNumber').val();
                const storeLabel = $('#storeLabel').val();
                const terminalLabel = $('#terminalLabel').val();
                const purposeOfTransaction = $('#purpose').val();
                const languagePreference = $('#languagePreference').val();
                const merchantNameAlternateLanguage = $('#merchantNameAlt').val();
                const merchantCityAlternateLanguage = $('#merchantCityAlt').val();
                const upiMerchantAccount = $('#upiAccount').val();

                // This is where you would construct the data according to the Bakong KHQR specification.
                // Since bakong-khqr is a Node.js library, we'll simulate the data structure
                // for a generic QR code library that accepts a string.
                // In a real application, you'd send this data to your backend which uses bakong-khqr
                // and returns the QR string, or you'd find a client-side library implementing the spec.

                // For demonstration, let's create a simple string that *could* be a QR code content
                // based on the inputs. This is NOT a real Bakong KHQR string generated by the library.
                const qrContent = `
                    Merchant ID: ${merchantId}
                    Name: ${merchantName}
                    City: ${merchantCity}
                    Currency: ${currency.toUpperCase()}
                    Amount: ${amount.toFixed(2)}
                    Mobile: ${mobileNumber}
                    Store: ${storeLabel}
                    Terminal: ${terminalLabel}
                    Purpose: ${purposeOfTransaction}
                    Lang Pref: ${languagePreference.toUpperCase()}
                    Alt Name: ${merchantNameAlternateLanguage}
                    Alt City: ${merchantCityAlternateLanguage}
                    UPI: ${upiMerchantAccount}
                `.trim();

                // Clear previous QR code
                $('#qrCodeContainer').empty();
                $('#qrDataDisplay').empty();

                // Generate QR code using qrcode.js
                // The 'qrcode.js' library takes an element ID or a DOM element, and the text to encode.
                new QRCode(document.getElementById("qrCodeContainer"), {
                    text: qrContent,
                    width: 256,
                    height: 256,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });

                $('#qrDataDisplay').text("Generated QR Content (for demonstration):\n" + qrContent);

                // If you had a backend endpoint that uses bakong-khqr:
                /*
                $.ajax({
                    url: '/generate-bakong-khqr', // Your backend endpoint
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        merchantId, merchantName, merchantCity, currency, amount,
                        mobileNumber, storeLabel, terminalLabel, purposeOfTransaction,
                        languagePreference, merchantNameAlternateLanguage,
                        merchantCityAlternateLanguage, upiMerchantAccount
                    }),
                    success: function(response) {
                        $('#qrCodeContainer').empty(); // Clear previous QR
                        new QRCode(document.getElementById("qrCodeContainer"), {
                            text: response.qr, // Assuming your backend returns { qr: "actual_bakong_qr_string" }
                            width: 256,
                            height: 256,
                            colorDark : "#000000",
                            colorLight : "#ffffff",
                            correctLevel : QRCode.CorrectLevel.H
                        });
                        $('#qrDataDisplay').text("Raw Bakong KHQR Data:\n" + response.qr);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error generating QR:", textStatus, errorThrown);
                        $('#qrDataDisplay').text("Error generating QR code. Please check console.");
                    }
                });
                */
            });
        });
    </script>
</body>
</html>
