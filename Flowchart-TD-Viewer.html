<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowchart TD Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-pulse-custom { animation: pulse 1.5s infinite; }
        .animate-slide-in { animation: slideIn 0.6s ease-out; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-400 via-blue-500 to-purple-700 p-5 bg-fixed">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <h1 class="text-center text-white text-4xl md:text-5xl font-bold mb-10 bg-gradient-to-r from-pink-400 to-teal-400 bg-clip-text text-transparent drop-shadow-lg">
            Flowchart TD Viewer
        </h1>
        
        <!-- Main Content Grid -->
        <div class="grid lg:grid-cols-2 gap-8 items-start">
            <!-- Left: Input Section -->
            <div class="bg-white/15 backdrop-blur-xl border border-white/20 p-8 rounded-3xl shadow-2xl animate-slide-in">
                <h3 class="text-white text-xl font-semibold mb-4">Paste your flowchart TD code:</h3>
                <textarea 
                    id="flowchartInput" 
                    class="w-full h-64 p-5 border-none rounded-2xl font-mono text-sm resize-none bg-white/90 backdrop-blur-md shadow-inner transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-teal-400/40 focus:scale-[1.02]"
                    placeholder="flowchart TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Action 1]
    B -->|No| D[Action 2]
    C --> E[End]
    D --> E"
                ></textarea>
                
                <div class="mt-5 p-5 bg-teal-400/10 border border-teal-400/30 rounded-2xl backdrop-blur-md">
                    <div class="font-bold mb-3 text-teal-300 text-sm">Example:</div>
                    <div class="font-mono bg-white/10 p-3 rounded-lg text-white/90 border border-white/10 text-xs">
                        flowchart TD<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;A[Start] --> B{Decision}<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;B -->|Yes| C[Action 1]<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;B -->|No| D[Action 2]<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;C --> E[End]<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;D --> E
                    </div>
                </div>
                
                <div id="error-message"></div>
            </div>
            
            <!-- Right: Preview Section -->
            <div class="bg-white/15 backdrop-blur-xl border border-white/20 p-8 rounded-3xl shadow-2xl animate-slide-in relative h-fit min-h-96">
                <div class="flex items-center justify-between mb-5">
                    <div class="flex items-center gap-3">
                        <h3 class="text-white text-xl font-semibold">Live Preview:</h3>
                        <span id="render-status" class="px-3 py-1 text-sm font-medium rounded-full bg-gray-500/20 text-gray-400 border border-gray-500/30">
                            Ready
                        </span>
                    </div>
                    <div class="flex gap-3">
                        <button 
                            id="maximize-btn"
                            title="Maximize Preview"
                            class="w-10 h-10 bg-white/20 hover:bg-white/30 border-none text-white rounded-full cursor-pointer text-lg transition-all duration-300 hover:scale-110 backdrop-blur-md"
                        >‚õ∂</button>
                        <button 
                            id="download-btn"
                            title="Download as PNG"
                            class="w-10 h-10 bg-white/20 hover:bg-white/30 border-none text-white rounded-full cursor-pointer text-lg transition-all duration-300 hover:scale-110 backdrop-blur-md"
                        >üì•</button>
                        <button 
                            id="copy-btn"
                            title="Copy SVG Code"
                            class="w-10 h-10 bg-white/20 hover:bg-white/30 border-none text-white rounded-full cursor-pointer text-lg transition-all duration-300 hover:scale-110 backdrop-blur-md"
                        >üìã</button>
                        <button 
                            id="clear-btn"
                            title="Clear Preview"
                            class="w-10 h-10 bg-white/20 hover:bg-white/30 border-none text-white rounded-full cursor-pointer text-lg transition-all duration-300 hover:scale-110 backdrop-blur-md"
                        >üóëÔ∏è</button>
                    </div>
                </div>
                <div id="mermaid-preview" class="text-center mt-5 bg-white/95 p-8 rounded-2xl shadow-xl min-h-32">
                    <div class="text-gray-500 italic">Enter flowchart code to see live preview</div>
                </div>
            </div>
        </div>
        
        <!-- Feedback Section -->
        <div class="mt-8 bg-white/15 backdrop-blur-xl border border-white/20 p-8 rounded-3xl shadow-2xl animate-slide-in">
            <h3 class="text-white text-xl font-semibold mb-5">üìù Feedback</h3>
            <div class="feedback-form">
                <div class="flex items-center gap-4 mb-4">
                    <span class="text-white font-medium">Rate this tool:</span>
                    <div class="flex gap-1">
                        <span class="text-2xl cursor-pointer transition-all duration-300 grayscale hover:grayscale-0 hover:scale-125 star" data-rating="1">‚≠ê</span>
                        <span class="text-2xl cursor-pointer transition-all duration-300 grayscale hover:grayscale-0 hover:scale-125 star" data-rating="2">‚≠ê</span>
                        <span class="text-2xl cursor-pointer transition-all duration-300 grayscale hover:grayscale-0 hover:scale-125 star" data-rating="3">‚≠ê</span>
                        <span class="text-2xl cursor-pointer transition-all duration-300 grayscale hover:grayscale-0 hover:scale-125 star" data-rating="4">‚≠ê</span>
                        <span class="text-2xl cursor-pointer transition-all duration-300 grayscale hover:grayscale-0 hover:scale-125 star" data-rating="5">‚≠ê</span>
                    </div>
                </div>
                <textarea 
                    id="feedbackText" 
                    class="w-full h-32 p-4 border-none rounded-2xl font-mono text-sm resize-none bg-white/90 backdrop-blur-md shadow-inner mb-4"
                    placeholder="Share your thoughts, suggestions, or report issues..."
                ></textarea>
                <button 
                    onclick="submitFeedback()" 
                    class="bg-gradient-to-r from-teal-400 to-green-500 hover:from-teal-500 hover:to-green-600 text-white border-none px-8 py-4 rounded-full cursor-pointer text-base font-semibold transition-all duration-300 hover:-translate-y-1 hover:shadow-xl active:-translate-y-0.5 shadow-lg"
                >
                    Send Feedback
                </button>
                <div id="feedback-status" class="mt-3"></div>
            </div>
        </div>
    </div>
    
    <!-- Maximize Overlay -->
    <div id="maximize-overlay" class="fixed inset-0 bg-black/95 backdrop-blur-md z-50 hidden items-center justify-center p-5 transition-all duration-300 opacity-0">
        <div class="bg-white rounded-2xl p-8 max-w-[95vw] max-h-[95vh] overflow-auto relative shadow-2xl transform scale-95 transition-all duration-300">
            <button 
                id="close-maximize-btn"
                class="absolute top-4 right-4 bg-red-500 hover:bg-red-600 text-white border-none w-10 h-10 rounded-full cursor-pointer text-lg font-bold transition-all duration-200 hover:scale-110 z-10 shadow-lg"
                title="Close (ESC)"
            >√ó</button>
            
            <!-- Zoom Controls -->
            <div class="absolute top-4 left-4 flex gap-2 z-10">
                <button 
                    id="zoom-in-btn"
                    class="bg-blue-500 hover:bg-blue-600 text-white border-none w-10 h-10 rounded-full cursor-pointer text-lg transition-all duration-200 hover:scale-110 shadow-lg"
                    title="Zoom In (+)"
                >+</button>
                <button 
                    id="zoom-out-btn"
                    class="bg-blue-500 hover:bg-blue-600 text-white border-none w-10 h-10 rounded-full cursor-pointer text-lg transition-all duration-200 hover:scale-110 shadow-lg"
                    title="Zoom Out (-)"
                >-</button>
                <button 
                    id="reset-zoom-btn"
                    class="bg-gray-500 hover:bg-gray-600 text-white border-none px-3 h-10 rounded-full cursor-pointer text-sm transition-all duration-200 hover:scale-110 shadow-lg"
                    title="Reset Zoom (0)"
                >100%</button>
                <button 
                    id="fullscreen-btn"
                    class="bg-green-500 hover:bg-green-600 text-white border-none w-10 h-10 rounded-full cursor-pointer text-sm transition-all duration-200 hover:scale-110 shadow-lg"
                    title="Toggle Fullscreen (F)"
                >‚õ∂</button>
            </div>
            
            <!-- Download Controls -->
            <div class="absolute top-4 right-16 flex gap-2 z-10">
                <button 
                    id="download-png-btn"
                    class="bg-purple-500 hover:bg-purple-600 text-white border-none px-3 h-10 rounded-full cursor-pointer text-sm transition-all duration-200 hover:scale-110 shadow-lg"
                    title="Download PNG"
                >PNG</button>
                <button 
                    id="download-svg-btn"
                    class="bg-indigo-500 hover:bg-indigo-600 text-white border-none px-3 h-10 rounded-full cursor-pointer text-sm transition-all duration-200 hover:scale-110 shadow-lg"
                    title="Download SVG"
                >SVG</button>
            </div>
            
            <div id="maximized-preview" class="mt-16 transition-transform duration-200 transform-origin-center"></div>
        </div>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: false });
        
        let selectedRating = 0;
        let renderTimeout;
        let currentZoom = 1;
        
        $(document).ready(function() {

            // Load saved content on page load
            const savedContent = localStorage.getItem('flowchart-input');
            if (savedContent) {
                $('#flowchartInput').val(savedContent);
                // Trigger render if content exists
                if (savedContent.trim()) {
                    renderFlowchart();
                }
            }

            // Star rating functionality
            $('.star').click(function() {
                selectedRating = parseInt($(this).data('rating'));
                updateStars();
            });
            
            // Auto-render on textarea change
            $('#flowchartInput').on('input', function() {
                clearTimeout(renderTimeout);
                updateRenderStatus('rendering', '‚è≥ Rendering...');
                
                // Debounce rendering by 500ms
                renderTimeout = setTimeout(() => {
                    renderFlowchart();
                }, 500);
            });
            
            // Button handlers
            $('#maximize-btn').click(maximizePreview);
            $('#clear-btn').click(clearPreview);
            $('#copy-btn').click(copySVG);
            $('#download-btn').click(downloadPNG);
            
            // Initial render if there's content
            if ($('#flowchartInput').val().trim()) {
                renderFlowchart();
            }
            
            // Keyboard shortcuts
            $(document).keydown(function(e) {
                // Global shortcuts
                if (e.ctrlKey || e.metaKey) {
                    switch(e.which) {
                        case 83: // Ctrl+S - Download
                            e.preventDefault();
                            downloadPNG();
                            break;
                        case 67: // Ctrl+C - Copy (when preview focused)
                            if ($('#mermaid-preview').is(':focus-within')) {
                                e.preventDefault();
                                copySVG();
                            }
                            break;
                    }
                }
                
                // Maximized view shortcuts
                if ($('#maximize-overlay').hasClass('flex')) {
                    switch(e.which) {
                        case 27: // ESC
                            closeMaximize();
                            break;
                        case 187: // +
                        case 61:  // + (Firefox)
                            e.preventDefault();
                            zoomIn();
                            break;
                        case 189: // -
                        case 173: // - (Firefox)
                            e.preventDefault();
                            zoomOut();
                            break;
                        case 48: // 0
                            e.preventDefault();
                            resetZoom();
                            break;
                        case 70: // F - Fullscreen
                            e.preventDefault();
                            toggleFullscreen();
                            break;
                    }
                }
            });
        });
        
        function updateRenderStatus(type, message) {
            const $statusEl = $('#render-status');
            $statusEl.removeClass().addClass('px-3 py-1 text-sm font-medium rounded-full border');
            
            if (type === 'rendering') {
                $statusEl.addClass('bg-yellow-400/20 text-yellow-400 border-yellow-400/30 animate-pulse-custom');
            } else if (type === 'success') {
                $statusEl.addClass('bg-green-400/20 text-green-400 border-green-400/30');
            } else {
                $statusEl.addClass('bg-gray-500/20 text-gray-400 border-gray-500/30');
            }
            
            $statusEl.text(message);
        }
        
        function updateStars() {
            $('.star').each(function(index) {
                if (index < selectedRating) {
                    $(this).removeClass('grayscale').addClass('scale-125');
                } else {
                    $(this).addClass('grayscale').removeClass('scale-125');
                }
            });
        }
        
        function maximizePreview() {
            const previewContent = $('#mermaid-preview').html();
            $('#maximized-preview').html(previewContent);
            
            // Animate opening
            const $overlay = $('#maximize-overlay');
            const $content = $overlay.find('.bg-white');
            
            $overlay.removeClass('hidden').addClass('flex');
            
            // Attach modal button handlers
            $('#close-maximize-btn').off('click').on('click', closeMaximize);
            $('#zoom-in-btn').off('click').on('click', zoomIn);
            $('#zoom-out-btn').off('click').on('click', zoomOut);
            $('#reset-zoom-btn').off('click').on('click', resetZoom);
            $('#fullscreen-btn').off('click').on('click', toggleFullscreen);
            $('#download-png-btn').off('click').on('click', downloadPNG);
            $('#download-svg-btn').off('click').on('click', downloadSVG);
            
            // Trigger reflow and animate
            setTimeout(() => {
                $overlay.removeClass('opacity-0');
                $content.removeClass('scale-95').addClass('scale-100');
            }, 10);
            
            $('body').css('overflow', 'hidden');
            currentZoom = 1;
            updateZoom();
        }
        
        function closeMaximize() {
            const $overlay = $('#maximize-overlay');
            const $content = $overlay.find('.bg-white');
            
            // Animate closing
            $overlay.addClass('opacity-0');
            $content.removeClass('scale-100').addClass('scale-95');
            
            setTimeout(() => {
                $overlay.addClass('hidden').removeClass('flex');
                $('body').css('overflow', 'auto');
            }, 300);
        }
        
        function clearPreview() {
            $('#mermaid-preview').html('<div class="text-gray-500 italic">Enter flowchart code to see live preview</div>');
            $('#flowchartInput').val('');
            updateRenderStatus('idle', 'Ready');
            localStorage.removeItem('flowchart-input');
        }
        
        function copySVG() {
            const svgElement = $('#mermaid-preview svg');
            if (svgElement.length > 0) {
                const svgString = svgElement.prop('outerHTML');
                navigator.clipboard.writeText(svgString).then(() => {
                    showNotification('‚úÖ SVG copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('‚ùå Failed to copy SVG', 'error');
                });
            } else {
                showNotification('‚ö†Ô∏è No diagram to copy', 'warning');
            }
        }
        

        function downloadPNG() {
  const svgElement = document.querySelector("svg");
  const svgData = new XMLSerializer().serializeToString(svgElement);

  // Get tight bounding box
  const bbox = svgElement.getBBox();
  const width = Math.ceil(bbox.width);
  const height = Math.ceil(bbox.height);

  // Scale factor for sharpness
  const scale = 3;

  const canvas = document.createElement("canvas");
  canvas.width = width * scale;
  canvas.height = height * scale;
  const ctx = canvas.getContext("2d");

  const img = new Image();
  img.onload = function () {
    ctx.setTransform(scale, 0, 0, scale, -bbox.x * scale, -bbox.y * scale);
    ctx.drawImage(img, 0, 0);

    const png = canvas.toDataURL("image/png");
    const link = document.createElement("a");
    link.download = "flowchart.png";
    link.href = png;
    link.click();
  };

  // Inline SVG and force exact bbox size
  const svgWithSize = svgData.replace(
    /<svg([^>]+)>/,
    `<svg$1 width="${width}" height="${height}" viewBox="${bbox.x} ${bbox.y} ${width} ${height}">`
  );

  const svgBase64 = btoa(unescape(encodeURIComponent(svgWithSize)));
  img.src = "data:image/svg+xml;base64," + svgBase64;
}
        
        
        function downloadSVG() {
            const svgElement = $('#mermaid-preview svg');
            if (svgElement.length > 0) {
                const svgString = svgElement.prop('outerHTML');
                const blob = new Blob([svgString], {type: 'image/svg+xml'});
                const link = document.createElement('a');
                link.download = 'flowchart-' + new Date().getTime() + '.svg';
                link.href = URL.createObjectURL(blob);
                link.click();
                URL.revokeObjectURL(link.href);
                showNotification('üì• SVG downloaded!', 'success');
            } else {
                showNotification('‚ö†Ô∏è No diagram to download', 'warning');
            }
        }
        
        function zoomIn() {
            currentZoom = Math.min(currentZoom + 0.25, 3);
            updateZoom();
        }
        
        function zoomOut() {
            currentZoom = Math.max(currentZoom - 0.25, 0.25);
            updateZoom();
        }
        
        function resetZoom() {
            currentZoom = 1;
            updateZoom();
        }
        
        function updateZoom() {
            $('#maximized-preview').css('transform', `scale(${currentZoom})`);
            $('#reset-zoom-btn').text(`${Math.round(currentZoom * 100)}%`);
        }
        
        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }
        
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            $('.notification').remove();
            
            const colors = {
                success: 'bg-green-500/90 text-white border-green-400',
                error: 'bg-red-500/90 text-white border-red-400',
                warning: 'bg-yellow-500/90 text-black border-yellow-400',
                info: 'bg-blue-500/90 text-white border-blue-400'
            };
            
            const notification = $(`
                <div class="notification fixed top-5 right-5 z-50 px-4 py-3 rounded-lg shadow-lg border backdrop-blur-md transform translate-x-full transition-transform duration-300 ${colors[type]}">
                    ${message}
                </div>
            `);
            
            $('body').append(notification);
            
            // Animate in
            setTimeout(() => {
                notification.removeClass('translate-x-full');
            }, 10);
            
            // Auto remove
            setTimeout(() => {
                notification.addClass('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        async function renderFlowchart() {
            const input = $('#flowchartInput').val().trim();
            const $errorDiv = $('#error-message');
            const $previewDiv = $('#mermaid-preview');
            
            // Clear previous content
            $errorDiv.html('');
            
            if (!input) {
                $previewDiv.html('<div class="text-gray-500 italic">Enter flowchart code to see live preview</div>');
                updateRenderStatus('idle', 'Ready');
                return;
            }
            
            try {
                // Create unique ID for the diagram
                const diagramId = 'mermaid-' + Date.now();
                
                // Render the mermaid diagram
                const {svg} = await mermaid.render(diagramId, input);
                $previewDiv.html(svg);
                updateRenderStatus('success', '‚úÖ Rendered');
                
                // Auto-hide success status after 2 seconds
                setTimeout(() => {
                    updateRenderStatus('idle', 'Ready');
                    localStorage.setItem('flowchart-input', input);
                }, 2000);
                
            } catch (error) {
                console.error('Render error:', error);
                $previewDiv.html(`<div class="text-red-400 p-5 text-center border border-red-400/30 rounded-lg bg-red-400/10">
                    <strong>Syntax Error:</strong><br>
                    ${error.message || 'Invalid flowchart syntax'}
                </div>`);
                updateRenderStatus('idle', '‚ùå Error');
            }
        }
        
        function submitFeedback() {
    const feedbackText = $('#feedbackText').val().trim();
    const $statusDiv = $('#feedback-status');

    if (!feedbackText && selectedRating === 0) {
        $statusDiv.html('<div class="p-3 bg-red-400/20 text-red-400 border border-red-400/30 rounded-lg">Please provide a rating or feedback message</div>');
        return;
    }

    // Define your repo
    const owner = 'pheasa';  // GitHub username
    const repo = 'pheasa.github.io';  // Repo name

    const issueTitle = `Feedback ${new Date().toISOString().split('T')[0]} - ${selectedRating ? selectedRating + '/5 ‚≠ê' : 'General'}`;
    const issueBody = `
## User Feedback

**Rating:** ${selectedRating ? selectedRating + '/5 ‚≠ê'.repeat(selectedRating) : 'No rating'}

**Message:**
${feedbackText}

---
**Tool:** Flowchart TD Viewer  
**Timestamp:** ${new Date().toLocaleString()}  
**Browser:** ${navigator.userAgent}  
**URL:** ${window.location.href}
    `.trim();

    const labels = selectedRating >= 4 ? 'positive' : selectedRating <= 2 ? 'needs-improvement' : 'neutral';

    // Encode URL
    const url = `https://github.com/${owner}/${repo}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}&labels=feedback,${labels}`;

    // Open GitHub issue in new tab
    window.open(url, '_blank');

    $statusDiv.html('<div class="p-3 bg-green-400/20 text-green-400 border border-green-400/30 rounded-lg">üåê GitHub opened - please submit your feedback manually!<br><small>Note: You need to be logged in to GitHub</small></div>');

    // Clear form
    $('#feedbackText').val('');
    selectedRating = 0;
    updateStars();
}

    </script>
</body>
</html>
